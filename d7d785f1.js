import{c as D}from"./48cbdad6.js";import{n as M,r as L,w as U,a as K,u as C,i as W,v as F,g as S,b as N,o as B}from"./7e6bdc84.js";const q=["script","style","noscript"],V=["base","meta","link","style","script","noscript"],J=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function Q(e,r){const{props:t,tag:n}=e;if(J.includes(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];n==="meta"&&s.push("name","property","http-equiv");for(const a of s)if(typeof t[a]<"u"){const d=String(t[a]);return r&&!r(d)?!1:`${n}:${a}:${d}`}return!1}const b=(e,r)=>{const{tag:t,$el:n}=e;n&&(Object.entries(t.props).forEach(([s,a])=>{a=String(a);const d=`attr:${s}`;if(s==="class"){if(!a)return;for(const c of a.split(" ")){const p=`${d}:${c}`;r&&r(e,p,()=>n.classList.remove(c)),n.classList.contains(c)||n.classList.add(c)}return}r&&!s.startsWith("data-h-")&&r(e,d,()=>n.removeAttribute(s)),n.getAttribute(s)!==a&&n.setAttribute(s,a)}),q.includes(t.tag)&&n.innerHTML!==(t.children||"")&&(n.innerHTML=t.children||""))};function H(e){let r=9;for(let t=0;t<e.length;)r=Math.imul(r^e.charCodeAt(t++),9**9);return((r^r>>>9)+65536).toString(16).substring(1,8).toLowerCase()}async function k(e,r={}){const t={shouldRender:!0};if(await e.hooks.callHook("dom:beforeRender",t),!t.shouldRender)return;const n=r.document||window.document,s=e._popSideEffectQueue();e.headEntries().map(o=>o._sde).forEach(o=>{Object.entries(o).forEach(([i,l])=>{s[i]=l})});const a=async o=>{const i=e.headEntries().find(f=>f._i===o._e),l={renderId:o._d||H(JSON.stringify({...o,_e:void 0,_p:void 0})),$el:null,shouldRender:!0,tag:o,entry:i,staleSideEffects:s};return await e.hooks.callHook("dom:beforeRenderTag",l),l},d=[],c={body:[],head:[]},p=(o,i,l)=>{i=`${o.renderId}:${i}`,o.entry&&(o.entry._sde[i]=l),delete s[i]},u=o=>{e._elMap[o.renderId]=o.$el,d.push(o),p(o,"el",()=>{o.$el?.remove(),delete e._elMap[o.renderId]})};for(const o of await e.resolveTags()){const i=await a(o);if(!i.shouldRender)continue;const{tag:l}=i;if(l.tag==="title"){n.title=l.children||"",d.push(i);continue}if(l.tag==="htmlAttrs"||l.tag==="bodyAttrs"){i.$el=n[l.tag==="htmlAttrs"?"documentElement":"body"],b(i,p),d.push(i);continue}if(i.$el=e._elMap[i.renderId],!i.$el&&l._hash&&(i.$el=n.querySelector(`${l.tagPosition?.startsWith("body")?"body":"head"} > ${l.tag}[data-h-${l._hash}]`)),i.$el){i.tag._d&&b(i),u(i);continue}i.$el=n.createElement(l.tag),b(i),c[l.tagPosition?.startsWith("body")?"body":"head"].push(i)}Object.entries(c).forEach(([o,i])=>{if(!i.length)return;const l=n?.[o]?.children;if(l){for(const f of[...l].reverse()){const y=f.tagName.toLowerCase();if(!V.includes(y))continue;const T=Q({tag:y,props:f.getAttributeNames().reduce((h,m)=>({...h,[m]:f.getAttribute(m)}),{})}),g=i.findIndex(h=>h&&(h.tag._d===T||f.isEqualNode?.(h.$el)));if(g!==-1){const h=i[g];h.$el=f,b(h),u(h),delete i[g]}}i.forEach(f=>{if(f.$el){switch(f.tag.tagPosition){case"bodyClose":n.body.appendChild(f.$el);break;case"bodyOpen":n.body.insertBefore(f.$el,n.body.firstChild);break;case"head":default:n.head.appendChild(f.$el);break}u(f)}})}});for(const o of d)await e.hooks.callHook("dom:renderTag",o);Object.values(s).forEach(o=>o())}let _=null;async function z(e,r={}){function t(){return _=null,k(e,r)}const n=r.delayFn||(s=>setTimeout(s,10));return _=_||new Promise(s=>n(()=>s(t())))}const G={__proto__:null,debouncedRenderDOMHead:z,get domUpdatePromise(){return _},hashCode:H,renderDOMHead:k},X=["title","titleTemplate","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"],Y=["tagPosition","tagPriority","tagDuplicateStrategy"];async function Z(e,r){const t={tag:e,props:{}};return e==="title"||e==="titleTemplate"?(t.children=r instanceof Promise?await r:r,t):(t.props=await x({...r}),["children","innerHtml","innerHTML"].forEach(n=>{typeof t.props[n]<"u"&&(t.children=t.props[n],typeof t.children=="object"&&(t.children=JSON.stringify(t.children)),delete t.props[n])}),Object.keys(t.props).filter(n=>Y.includes(n)).forEach(n=>{t[n]=t.props[n],delete t.props[n]}),typeof t.props.class=="object"&&!Array.isArray(t.props.class)&&(t.props.class=Object.keys(t.props.class).filter(n=>t.props.class[n])),Array.isArray(t.props.class)&&(t.props.class=t.props.class.join(" ")),t.props.content&&Array.isArray(t.props.content)?t.props.content.map((n,s)=>{const a={...t,props:{...t.props}};return a.props.content=n,a.key=`${t.props.name||t.props.property}:${s}`,a}):t)}async function x(e){for(const r of Object.keys(e))e[r]instanceof Promise&&(e[r]=await e[r]),String(e[r])==="true"?e[r]="":String(e[r])==="false"&&delete e[r];return e}const P=e=>{if(typeof e.tagPriority=="number")return e.tagPriority;switch(e.tagPriority){case"critical":return 2;case"high":return 9;case"low":return 12}switch(e.tag){case"base":return-1;case"title":return 1;case"meta":return e.props.charset?-2:e.props["http-equiv"]==="content-security-policy"?0:10;default:return 10}},ee=(e,r)=>P(e)-P(r),te=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function ne(e,r){const{props:t,tag:n}=e;if(te.includes(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];n==="meta"&&s.push("name","property","http-equiv");for(const a of s)if(typeof t[a]<"u"){const d=String(t[a]);return r&&!r(d)?!1:`${n}:${a}:${d}`}return!1}const O=(e,r)=>e==null?r||null:typeof e=="function"?e(r):e.replace("%s",r??"");function re(e){let r=e.findIndex(n=>n.tag==="titleTemplate");const t=e.findIndex(n=>n.tag==="title");if(t!==-1&&r!==-1){const n=O(e[r].children,e[t].children);n!==null?e[t].children=n||e[t].children:delete e[t]}else if(r!==-1){const n=O(e[r].children);n!==null&&(e[r].children=n,e[r].tag="title",r=-1)}return r!==-1&&delete e[r],e.filter(Boolean)}const se=e=>{e=e||{};const r=e.dedupeKeys||["hid","vmid","key"];return{hooks:{"tag:normalise":function({tag:t}){r.forEach(s=>{t.props[s]&&(t.key=t.props[s],delete t.props[s])});const n=t.key?`${t.tag}:${t.key}`:ne(t);n&&(t._d=n)},"tags:resolve":function(t){const n={};t.tags.forEach(s=>{let a=s._d||s._p;const d=n[a];if(d){let c=s?.tagDuplicateStrategy;if(!c&&(s.tag==="htmlAttrs"||s.tag==="bodyAttrs")&&(c="merge"),c==="merge"){const u=d.props;["class","style"].forEach(o=>{s.props[o]&&u[o]&&(o==="style"&&!u[o].endsWith(";")&&(u[o]+=";"),s.props[o]=`${u[o]} ${s.props[o]}`)}),n[a].props={...u,...s.props};return}else s._e===d._e&&(a=s._d=`${a}:${s._p}`);const p=Object.keys(s.props).length;if((p===0||p===1&&typeof s.props["data-h-key"]<"u")&&!s.children){delete n[a];return}}n[a]=s}),t.tags=Object.values(n)}}}},oe=()=>({hooks:{"tags:resolve":e=>{const r=t=>e.tags.find(n=>n._d===t)?._p;for(const t of e.tags){if(!t.tagPriority||typeof t.tagPriority=="number")continue;const n=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}];for(const{prefix:s,offset:a}of n)if(t.tagPriority.startsWith(s)){const d=t.tagPriority.replace(s,""),c=r(d);typeof c<"u"&&(t._p=c+a)}}e.tags.sort((t,n)=>t._p-n._p).sort(ee)}}}),ie=()=>({hooks:{"tags:resolve":e=>{e.tags=re(e.tags)}}}),ae=()=>({hooks:{"tag:normalise":function({tag:e}){typeof e.props.body<"u"&&(e.tagPosition="bodyClose",delete e.props.body)}}}),de=typeof window<"u",ce=()=>({hooks:{"tag:normalise":e=>{const{tag:r,entry:t}=e,n=typeof r.props._dynamic<"u";!I.includes(r.tag)||!r.key||(r._hash=H(JSON.stringify({tag:r.tag,key:r.key})),!(de||R()?.resolvedOptions?.document)&&(t._m==="server"||n)&&(r.props[`data-h-${r._hash}`]=""))},"tags:resolve":e=>{e.tags=e.tags.map(r=>(delete r.props._dynamic,r))}}}),le=e=>({hooks:{"entries:updated":function(r){if(typeof e?.document>"u"&&typeof window>"u")return;let t=e?.delayFn;!t&&typeof requestAnimationFrame<"u"&&(t=requestAnimationFrame),Promise.resolve().then(function(){return G}).then(({debouncedRenderDOMHead:n})=>{n(r,{document:e?.document||window.document,delayFn:t})})}}}),fe=()=>{const e=(r,t)=>{const n={},s={};Object.entries(t.props).forEach(([d,c])=>{d.startsWith("on")&&typeof c=="function"?s[d]=c:n[d]=c});let a;return r==="dom"&&t.tag==="script"&&typeof n.src=="string"&&typeof s.onload<"u"&&(a=n.src,delete n.src),{props:n,eventHandlers:s,delayedSrc:a}};return{hooks:{"ssr:render":function(r){r.tags=r.tags.map(t=>(t.props=e("ssr",t).props,t))},"dom:beforeRenderTag":function(r){const{props:t,eventHandlers:n,delayedSrc:s}=e("dom",r.tag);Object.keys(n).length&&(r.tag.props=t,r.tag._eventHandlers=n,r.tag._delayedSrc=s)},"dom:renderTag":function(r){const t=r.$el;if(!r.tag._eventHandlers||!t)return;const n=r.tag.tag==="bodyAttrs"&&typeof window<"u"?window:t;Object.entries(r.tag._eventHandlers).forEach(([s,a])=>{const d=`${r.tag._d||r.tag._p}:${s}`,c=s.slice(2).toLowerCase(),p=`data-h-${c}`;if(delete r.staleSideEffects[d],t.hasAttribute(p))return;const u=a;t.setAttribute(p,""),n.addEventListener(c,u),r.entry&&(r.entry._sde[d]=()=>{n.removeEventListener(c,u),t.removeAttribute(p)})}),r.tag._delayedSrc&&t.setAttribute("src",r.tag._delayedSrc)}}}};function ue(e){return Array.isArray(e)?e:[e]}const I=["base","meta","link","style","script","noscript"];let j;const pe=e=>j=e,R=()=>j,he=10;async function ge(e){const r=[];return Object.entries(e.resolvedInput||e.input).filter(([t,n])=>typeof n<"u"&&X.includes(t)).forEach(([t,n])=>{const s=ue(n);r.push(...s.map(a=>Z(t,a)).flat())}),(await Promise.all(r)).flat().map((t,n)=>(t._e=e._i,t._p=(e._i<<he)+n,t))}const ye=()=>[se(),oe(),ie(),ce(),fe(),ae()],me=(e={})=>[le({document:e?.document,delayFn:e?.domDelayFn})];function be(e={}){const r=$e({...e,plugins:[...me(e),...e?.plugins||[]]});return pe(r),r}function $e(e={}){let r=[],t={},n=0;const s=D();e?.hooks&&s.addHooks(e.hooks),e.plugins=[...ye(),...e?.plugins||[]],e.plugins.forEach(c=>c.hooks&&s.addHooks(c.hooks));const a=()=>s.callHook("entries:updated",d),d={resolvedOptions:e,headEntries(){return r},get hooks(){return s},use(c){c.hooks&&s.addHooks(c.hooks)},push(c,p){const u={_i:n++,input:c,_sde:{}};return p?.mode&&(u._m=p?.mode),r.push(u),a(),{dispose(){r=r.filter(o=>o._i!==u._i?!0:(t={...t,...o._sde||{}},o._sde={},a(),!1))},patch(o){r=r.map(i=>(i._i===u._i&&(u.input=i.input=o,a()),i))}}},async resolveTags(){const c={tags:[],entries:[...r]};await s.callHook("entries:resolve",c);for(const p of c.entries)for(const u of await ge(p)){const o={tag:u,entry:p};await s.callHook("tag:normalise",o),c.tags.push(o.tag)}return await s.callHook("tags:resolve",c),c.tags},_elMap:{},_popSideEffectQueue(){const c={...t};return t={},c}};return d.hooks.callHook("init",d),d}function _e(e){return typeof e=="function"?e():C(e)}function v(e,r=""){if(e instanceof Promise)return e;const t=_e(e);if(!e||!t)return t;if(Array.isArray(t))return t.map(n=>v(n,r));if(typeof t=="object"){let n=!1;const s=Object.fromEntries(Object.entries(t).map(([a,d])=>a==="titleTemplate"||a.startsWith("on")?[a,C(d)]:((typeof d=="function"||W(d))&&(n=!0),[a,v(d,a)])));return n&&I.includes(String(r))&&(s._dynamic=!0),s}return t}const ve=F.startsWith("3"),Te=typeof window<"u",A="usehead";function E(){return S()&&N(A)||R()}function Re(e={}){const r=be({...e,domDelayFn:n=>setTimeout(()=>M(()=>n()),10),plugins:[we(),...e?.plugins||[]]}),t={install(n){ve&&(n.config.globalProperties.$unhead=r,n.provide(A,r))}};return r.install=t.install,r}const we=()=>({hooks:{"entries:resolve":function(e){for(const r of e.entries)r.resolvedInput=v(r.input)}}}),De=function(e,r){e.mixin({beforeCreate(){const t=this.$options,n=t.provide;t.provide=function(){let s;return typeof n=="function"?s=n.call(this):s=n||{},{...s,[A]:r}}}})};function He(e,r={}){const t=E(),n=L({});U(()=>{n.value=v(e)});const s=t.push(n.value,r);return K(n,d=>s.patch(d)),S()&&B(()=>{s.dispose()}),s}function Ae(e,r={}){return E().push(e,r)}function Me(e,r={}){const t=E();if(t){const n=Te||!!t.resolvedOptions?.document;return r.mode==="server"&&n||r.mode==="client"&&!n?void 0:n?He(e,r):Ae(e,r)}}const Ee=["script","style","noscript"],Pe=["base","meta","link","style","script","noscript"],Oe=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function Ce(e,r){const{props:t,tag:n}=e;if(Oe.includes(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];n==="meta"&&s.push("name","property","http-equiv");for(const a of s)if(typeof t[a]<"u"){const d=String(t[a]);return r&&!r(d)?!1:`${n}:${a}:${d}`}return!1}const $=(e,r)=>{const{tag:t,$el:n}=e;n&&(Object.entries(t.props).forEach(([s,a])=>{a=String(a);const d=`attr:${s}`;if(s==="class"){if(!a)return;for(const c of a.split(" ")){const p=`${d}:${c}`;r&&r(e,p,()=>n.classList.remove(c)),n.classList.contains(c)||n.classList.add(c)}return}r&&!s.startsWith("data-h-")&&r(e,d,()=>n.removeAttribute(s)),n.getAttribute(s)!==a&&n.setAttribute(s,a)}),Ee.includes(t.tag)&&n.innerHTML!==(t.children||"")&&(n.innerHTML=t.children||""))};function Se(e){let r=9;for(let t=0;t<e.length;)r=Math.imul(r^e.charCodeAt(t++),9**9);return((r^r>>>9)+65536).toString(16).substring(1,8).toLowerCase()}async function ke(e,r={}){const t={shouldRender:!0};if(await e.hooks.callHook("dom:beforeRender",t),!t.shouldRender)return;const n=r.document||window.document,s=e._popSideEffectQueue();e.headEntries().map(o=>o._sde).forEach(o=>{Object.entries(o).forEach(([i,l])=>{s[i]=l})});const a=async o=>{const i=e.headEntries().find(f=>f._i===o._e),l={renderId:o._d||Se(JSON.stringify({...o,_e:void 0,_p:void 0})),$el:null,shouldRender:!0,tag:o,entry:i,staleSideEffects:s};return await e.hooks.callHook("dom:beforeRenderTag",l),l},d=[],c={body:[],head:[]},p=(o,i,l)=>{i=`${o.renderId}:${i}`,o.entry&&(o.entry._sde[i]=l),delete s[i]},u=o=>{e._elMap[o.renderId]=o.$el,d.push(o),p(o,"el",()=>{o.$el?.remove(),delete e._elMap[o.renderId]})};for(const o of await e.resolveTags()){const i=await a(o);if(!i.shouldRender)continue;const{tag:l}=i;if(l.tag==="title"){n.title=l.children||"",d.push(i);continue}if(l.tag==="htmlAttrs"||l.tag==="bodyAttrs"){i.$el=n[l.tag==="htmlAttrs"?"documentElement":"body"],$(i,p),d.push(i);continue}if(i.$el=e._elMap[i.renderId],!i.$el&&l._hash&&(i.$el=n.querySelector(`${l.tagPosition?.startsWith("body")?"body":"head"} > ${l.tag}[data-h-${l._hash}]`)),i.$el){i.tag._d&&$(i),u(i);continue}i.$el=n.createElement(l.tag),$(i),c[l.tagPosition?.startsWith("body")?"body":"head"].push(i)}Object.entries(c).forEach(([o,i])=>{if(!i.length)return;const l=n?.[o]?.children;if(l){for(const f of[...l].reverse()){const y=f.tagName.toLowerCase();if(!Pe.includes(y))continue;const T=Ce({tag:y,props:f.getAttributeNames().reduce((h,m)=>({...h,[m]:f.getAttribute(m)}),{})}),g=i.findIndex(h=>h&&(h.tag._d===T||f.isEqualNode?.(h.$el)));if(g!==-1){const h=i[g];h.$el=f,$(h),u(h),delete i[g]}}i.forEach(f=>{if(f.$el){switch(f.tag.tagPosition){case"bodyClose":n.body.appendChild(f.$el);break;case"bodyOpen":n.body.insertBefore(f.$el,n.body.firstChild);break;case"head":default:n.head.appendChild(f.$el);break}u(f)}})}});for(const o of d)await e.hooks.callHook("dom:renderTag",o);Object.values(s).forEach(o=>o())}let w=null;async function Le(e,r={}){function t(){return w=null,ke(e,r)}const n=r.delayFn||(s=>setTimeout(s,10));return w=w||new Promise(s=>n(()=>s(t())))}export{De as V,Re as c,Le as d,ke as r,Me as u};
