import{c as R}from"./hookable-48cbdad6.js";import{n as D,r as M,w as L,a as U,u as O,i as K,v as W,g as C,b as F,o as N}from"./@vue-7e6bdc84.js";const B=["script","style","noscript"],q=["base","meta","link","style","script","noscript"],V=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function J(e,r){const{props:t,tag:n}=e;if(V.includes(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];n==="meta"&&s.push("name","property","http-equiv");for(const d of s)if(typeof t[d]<"u"){const c=String(t[d]);return r&&!r(c)?!1:`${n}:${d}:${c}`}return!1}const m=(e,r)=>{const{tag:t,$el:n}=e;n&&(Object.entries(t.props).forEach(([s,d])=>{d=String(d);const c=`attr:${s}`;if(s==="class"){if(!d)return;for(const l of d.split(" ")){const u=`${c}:${l}`;r&&r(e,u,()=>n.classList.remove(l)),n.classList.contains(l)||n.classList.add(l)}return}r&&!s.startsWith("data-h-")&&r(e,c,()=>n.removeAttribute(s)),n.getAttribute(s)!==d&&n.setAttribute(s,d)}),B.includes(t.tag)&&n.innerHTML!==(t.children||"")&&(n.innerHTML=t.children||""))};function w(e){let r=9;for(let t=0;t<e.length;)r=Math.imul(r^e.charCodeAt(t++),9**9);return((r^r>>>9)+65536).toString(16).substring(1,8).toLowerCase()}async function S(e,r={}){const t={shouldRender:!0};if(await e.hooks.callHook("dom:beforeRender",t),!t.shouldRender)return;const n=r.document||window.document,s=e._popSideEffectQueue();e.headEntries().map(o=>o._sde).forEach(o=>{Object.entries(o).forEach(([i,a])=>{s[i]=a})});const d=async o=>{const i=e.headEntries().find(h=>h._i===o._e),a={renderId:o._d||w(JSON.stringify({...o,_e:void 0,_p:void 0})),$el:null,shouldRender:!0,tag:o,entry:i,staleSideEffects:s};return await e.hooks.callHook("dom:beforeRenderTag",a),a},c=[],l={body:[],head:[]},u=(o,i,a)=>{i=`${o.renderId}:${i}`,o.entry&&(o.entry._sde[i]=a),delete s[i]},f=o=>{e._elMap[o.renderId]=o.$el,c.push(o),u(o,"el",()=>{o.$el?.remove(),delete e._elMap[o.renderId]})};for(const o of await e.resolveTags()){const i=await d(o);if(!i.shouldRender)continue;const{tag:a}=i;if(a.tag==="title"){n.title=a.children||"",c.push(i);continue}if(a.tag==="htmlAttrs"||a.tag==="bodyAttrs"){i.$el=n[a.tag==="htmlAttrs"?"documentElement":"body"],m(i,u),c.push(i);continue}if(i.$el=e._elMap[i.renderId],!i.$el&&a._hash&&(i.$el=n.querySelector(`${a.tagPosition?.startsWith("body")?"body":"head"} > ${a.tag}[data-h-${a._hash}]`)),i.$el){i.tag._d&&m(i),f(i);continue}i.$el=n.createElement(a.tag),m(i),l[a.tagPosition?.startsWith("body")?"body":"head"].push(i)}Object.entries(l).forEach(([o,i])=>{if(i.length){for(const a of[...n[o].children].reverse()){const h=a.tagName.toLowerCase();if(!q.includes(h))continue;const v=J({tag:h,props:a.getAttributeNames().reduce((p,y)=>({...p,[y]:a.getAttribute(y)}),{})}),g=i.findIndex(p=>p&&(p.tag._d===v||a.isEqualNode(p.$el)));if(g!==-1){const p=i[g];p.$el=a,m(p),f(p),delete i[g]}}i.forEach(a=>{if(a.$el){switch(a.tag.tagPosition){case"bodyClose":n.body.appendChild(a.$el);break;case"bodyOpen":n.body.insertBefore(a.$el,n.body.firstChild);break;case"head":default:n.head.appendChild(a.$el);break}f(a)}})}});for(const o of c)await e.hooks.callHook("dom:renderTag",o);Object.values(s).forEach(o=>o())}let $=null;async function Q(e,r={}){function t(){return $=null,S(e,r)}const n=r.delayFn||(s=>setTimeout(s,10));return $=$||new Promise(s=>n(()=>s(t())))}const z={__proto__:null,debouncedRenderDOMHead:Q,get domUpdatePromise(){return $},hashCode:w,renderDOMHead:S},G=["title","titleTemplate","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"],X=["tagPosition","tagPriority","tagDuplicateStrategy"];async function Y(e,r){const t={tag:e,props:{}};return e==="title"||e==="titleTemplate"?(t.children=r instanceof Promise?await r:r,t):(t.props=await Z({...r}),["children","innerHtml","innerHTML"].forEach(n=>{typeof t.props[n]<"u"&&(t.children=t.props[n],typeof t.children=="object"&&(t.children=JSON.stringify(t.children)),delete t.props[n])}),Object.keys(t.props).filter(n=>X.includes(n)).forEach(n=>{t[n]=t.props[n],delete t.props[n]}),typeof t.props.class=="object"&&!Array.isArray(t.props.class)&&(t.props.class=Object.keys(t.props.class).filter(n=>t.props.class[n])),Array.isArray(t.props.class)&&(t.props.class=t.props.class.join(" ")),t.props.content&&Array.isArray(t.props.content)?t.props.content.map((n,s)=>{const d={...t,props:{...t.props}};return d.props.content=n,d.key=`${t.props.name||t.props.property}:${s}`,d}):t)}async function Z(e){for(const r of Object.keys(e))e[r]instanceof Promise&&(e[r]=await e[r]),String(e[r])==="true"?e[r]="":String(e[r])==="false"&&delete e[r];return e}const E=e=>{if(typeof e.tagPriority=="number")return e.tagPriority;switch(e.tagPriority){case"critical":return 2;case"high":return 9;case"low":return 12}switch(e.tag){case"base":return-1;case"title":return 1;case"meta":return e.props.charset?-2:e.props["http-equiv"]==="content-security-policy"?0:10;default:return 10}},x=(e,r)=>E(e)-E(r),ee=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function te(e,r){const{props:t,tag:n}=e;if(ee.includes(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];n==="meta"&&s.push("name","property","http-equiv");for(const d of s)if(typeof t[d]<"u"){const c=String(t[d]);return r&&!r(c)?!1:`${n}:${d}:${c}`}return!1}const P=(e,r)=>e==null?r||null:typeof e=="function"?e(r):e.replace("%s",r??"");function ne(e){let r=e.findIndex(n=>n.tag==="titleTemplate");const t=e.findIndex(n=>n.tag==="title");if(t!==-1&&r!==-1){const n=P(e[r].children,e[t].children);n!==null?e[t].children=n||e[t].children:delete e[t]}else if(r!==-1){const n=P(e[r].children);n!==null&&(e[r].children=n,e[r].tag="title",r=-1)}return r!==-1&&delete e[r],e.filter(Boolean)}const re=e=>{e=e||{};const r=e.dedupeKeys||["hid","vmid","key"];return{hooks:{"tag:normalise":function({tag:t}){r.forEach(s=>{t.props[s]&&(t.key=t.props[s],delete t.props[s])});const n=t.key?`${t.tag}:${t.key}`:te(t);n&&(t._d=n)},"tags:resolve":function(t){const n={};t.tags.forEach(s=>{let d=s._d||s._p;const c=n[d];if(c){let l=s?.tagDuplicateStrategy;if(!l&&(s.tag==="htmlAttrs"||s.tag==="bodyAttrs")&&(l="merge"),l==="merge"){const f=c.props;["class","style"].forEach(o=>{s.props[o]&&f[o]&&(o==="style"&&!f[o].endsWith(";")&&(f[o]+=";"),s.props[o]=`${f[o]} ${s.props[o]}`)}),n[d].props={...f,...s.props};return}else s._e===c._e&&(d=s._d=`${d}:${s._p}`);const u=Object.keys(s.props).length;if((u===0||u===1&&typeof s.props["data-h-key"]<"u")&&!s.children){delete n[d];return}}n[d]=s}),t.tags=Object.values(n)}}}},se=()=>({hooks:{"tags:resolve":e=>{const r=t=>e.tags.find(n=>n._d===t)?._p;for(const t of e.tags){if(!t.tagPriority||typeof t.tagPriority=="number")continue;const n=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}];for(const{prefix:s,offset:d}of n)if(t.tagPriority.startsWith(s)){const c=t.tagPriority.replace(s,""),l=r(c);typeof l<"u"&&(t._p=l+d)}}e.tags.sort((t,n)=>t._p-n._p).sort(x)}}}),oe=()=>({hooks:{"tags:resolve":e=>{e.tags=ne(e.tags)}}}),ie=()=>({hooks:{"tag:normalise":function({tag:e}){typeof e.props.body<"u"&&(e.tagPosition="bodyClose",delete e.props.body)}}}),ae=typeof window<"u",de=()=>({hooks:{"tag:normalise":e=>{const{tag:r,entry:t}=e,n=typeof r.props._dynamic<"u";!k.includes(r.tag)||!r.key||(r._hash=w(JSON.stringify({tag:r.tag,key:r.key})),!(ae||j()?.resolvedOptions?.document)&&(t._m==="server"||n)&&(r.props[`data-h-${r._hash}`]=""))},"tags:resolve":e=>{e.tags=e.tags.map(r=>(delete r.props._dynamic,r))}}}),ce=e=>({hooks:{"entries:updated":function(r){if(typeof e?.document>"u"&&typeof window>"u")return;let t=e?.delayFn;!t&&typeof requestAnimationFrame<"u"&&(t=requestAnimationFrame),Promise.resolve().then(function(){return z}).then(({debouncedRenderDOMHead:n})=>{n(r,{document:e?.document||window.document,delayFn:t})})}}}),le=()=>{const e=(r,t)=>{const n={},s={};Object.entries(t.props).forEach(([c,l])=>{c.startsWith("on")&&typeof l=="function"?s[c]=l:n[c]=l});let d;return r==="dom"&&t.tag==="script"&&typeof n.src=="string"&&typeof s.onload<"u"&&(d=n.src,delete n.src),{props:n,eventHandlers:s,delayedSrc:d}};return{hooks:{"ssr:render":function(r){r.tags=r.tags.map(t=>(t.props=e("ssr",t).props,t))},"dom:beforeRenderTag":function(r){const{props:t,eventHandlers:n,delayedSrc:s}=e("dom",r.tag);Object.keys(n).length&&(r.tag.props=t,r.tag._eventHandlers=n,r.tag._delayedSrc=s)},"dom:renderTag":function(r){const t=r.$el;if(!r.tag._eventHandlers||!t)return;const n=r.tag.tag==="bodyAttrs"&&typeof window<"u"?window:t;Object.entries(r.tag._eventHandlers).forEach(([s,d])=>{const c=`${r.tag._d||r.tag._p}:${s}`,l=s.slice(2).toLowerCase(),u=`data-h-${l}`;if(delete r.staleSideEffects[c],t.hasAttribute(u))return;const f=d;t.setAttribute(u,""),n.addEventListener(l,f),r.entry&&(r.entry._sde[c]=()=>{n.removeEventListener(l,f),t.removeAttribute(u)})}),r.tag._delayedSrc&&t.setAttribute("src",r.tag._delayedSrc)}}}};function fe(e){return Array.isArray(e)?e:[e]}const k=["base","meta","link","style","script","noscript"];let I;const ue=e=>I=e,j=()=>I,pe=10;async function he(e){const r=[];return Object.entries(e.resolvedInput||e.input).filter(([t,n])=>typeof n<"u"&&G.includes(t)).forEach(([t,n])=>{const s=fe(n);r.push(...s.map(d=>Y(t,d)).flat())}),(await Promise.all(r)).flat().map((t,n)=>(t._e=e._i,t._p=(e._i<<pe)+n,t))}const ge=()=>[re(),se(),oe(),de(),le(),ie()],ye=(e={})=>[ce({document:e?.document,delayFn:e?.domDelayFn})];function me(e={}){const r=be({...e,plugins:[...ye(e),...e?.plugins||[]]});return ue(r),r}function be(e={}){let r=[],t={},n=0;const s=R();e?.hooks&&s.addHooks(e.hooks),e.plugins=[...ge(),...e?.plugins||[]],e.plugins.forEach(l=>l.hooks&&s.addHooks(l.hooks));const d=()=>s.callHook("entries:updated",c),c={resolvedOptions:e,headEntries(){return r},get hooks(){return s},use(l){l.hooks&&s.addHooks(l.hooks)},push(l,u){const f={_i:n++,input:l,_sde:{}};return u?.mode&&(f._m=u?.mode),r.push(f),d(),{dispose(){r=r.filter(o=>o._i!==f._i?!0:(t={...t,...o._sde||{}},o._sde={},d(),!1))},patch(o){r=r.map(i=>(i._i===f._i&&(f.input=i.input=o,d()),i))}}},async resolveTags(){const l={tags:[],entries:[...r]};await s.callHook("entries:resolve",l);for(const u of l.entries)for(const f of await he(u)){const o={tag:f,entry:u};await s.callHook("tag:normalise",o),l.tags.push(o.tag)}return await s.callHook("tags:resolve",l),l.tags},_elMap:{},_popSideEffectQueue(){const l={...t};return t={},l}};return c.hooks.callHook("init",c),c}function $e(e){return typeof e=="function"?e():O(e)}function _(e,r=""){if(e instanceof Promise)return e;const t=$e(e);if(!e||!t)return t;if(Array.isArray(t))return t.map(n=>_(n,r));if(typeof t=="object"){let n=!1;const s=Object.fromEntries(Object.entries(t).map(([d,c])=>d==="titleTemplate"||d.startsWith("on")?[d,O(c)]:((typeof c=="function"||K(c))&&(n=!0),[d,_(c,d)])));return n&&k.includes(String(r))&&(s._dynamic=!0),s}return t}const _e=W.startsWith("3"),ve=typeof window<"u",H="usehead";function A(){return C()&&F(H)||j()}function je(e={}){const r=me({...e,domDelayFn:n=>setTimeout(()=>D(()=>n()),10),plugins:[Te(),...e?.plugins||[]]}),t={install(n){_e&&(n.config.globalProperties.$unhead=r,n.provide(H,r))}};return r.install=t.install,r}const Te=()=>({hooks:{"entries:resolve":function(e){for(const r of e.entries)r.resolvedInput=_(r.input)}}}),Re=function(e,r){e.mixin({beforeCreate(){const t=this.$options,n=t.provide;t.provide=function(){let s;return typeof n=="function"?s=n.call(this):s=n||{},{...s,[H]:r}}}})};function we(e,r={}){const t=A(),n=M({});L(()=>{n.value=_(e)});const s=t.push(n.value,r);return U(n,c=>s.patch(c)),C()&&N(()=>{s.dispose()}),s}function He(e,r={}){return A().push(e,r)}function De(e,r={}){const t=A();if(t){const n=ve||!!t.resolvedOptions?.document;return r.mode==="server"&&n||r.mode==="client"&&!n?void 0:n?we(e,r):He(e,r)}}const Ae=["script","style","noscript"],Ee=["base","meta","link","style","script","noscript"],Pe=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function Oe(e,r){const{props:t,tag:n}=e;if(Pe.includes(n))return n;if(n==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];n==="meta"&&s.push("name","property","http-equiv");for(const d of s)if(typeof t[d]<"u"){const c=String(t[d]);return r&&!r(c)?!1:`${n}:${d}:${c}`}return!1}const b=(e,r)=>{const{tag:t,$el:n}=e;n&&(Object.entries(t.props).forEach(([s,d])=>{d=String(d);const c=`attr:${s}`;if(s==="class"){if(!d)return;for(const l of d.split(" ")){const u=`${c}:${l}`;r&&r(e,u,()=>n.classList.remove(l)),n.classList.contains(l)||n.classList.add(l)}return}r&&!s.startsWith("data-h-")&&r(e,c,()=>n.removeAttribute(s)),n.getAttribute(s)!==d&&n.setAttribute(s,d)}),Ae.includes(t.tag)&&n.innerHTML!==(t.children||"")&&(n.innerHTML=t.children||""))};function Ce(e){let r=9;for(let t=0;t<e.length;)r=Math.imul(r^e.charCodeAt(t++),9**9);return((r^r>>>9)+65536).toString(16).substring(1,8).toLowerCase()}async function Se(e,r={}){const t={shouldRender:!0};if(await e.hooks.callHook("dom:beforeRender",t),!t.shouldRender)return;const n=r.document||window.document,s=e._popSideEffectQueue();e.headEntries().map(o=>o._sde).forEach(o=>{Object.entries(o).forEach(([i,a])=>{s[i]=a})});const d=async o=>{const i=e.headEntries().find(h=>h._i===o._e),a={renderId:o._d||Ce(JSON.stringify({...o,_e:void 0,_p:void 0})),$el:null,shouldRender:!0,tag:o,entry:i,staleSideEffects:s};return await e.hooks.callHook("dom:beforeRenderTag",a),a},c=[],l={body:[],head:[]},u=(o,i,a)=>{i=`${o.renderId}:${i}`,o.entry&&(o.entry._sde[i]=a),delete s[i]},f=o=>{e._elMap[o.renderId]=o.$el,c.push(o),u(o,"el",()=>{o.$el?.remove(),delete e._elMap[o.renderId]})};for(const o of await e.resolveTags()){const i=await d(o);if(!i.shouldRender)continue;const{tag:a}=i;if(a.tag==="title"){n.title=a.children||"",c.push(i);continue}if(a.tag==="htmlAttrs"||a.tag==="bodyAttrs"){i.$el=n[a.tag==="htmlAttrs"?"documentElement":"body"],b(i,u),c.push(i);continue}if(i.$el=e._elMap[i.renderId],!i.$el&&a._hash&&(i.$el=n.querySelector(`${a.tagPosition?.startsWith("body")?"body":"head"} > ${a.tag}[data-h-${a._hash}]`)),i.$el){i.tag._d&&b(i),f(i);continue}i.$el=n.createElement(a.tag),b(i),l[a.tagPosition?.startsWith("body")?"body":"head"].push(i)}Object.entries(l).forEach(([o,i])=>{if(i.length){for(const a of[...n[o].children].reverse()){const h=a.tagName.toLowerCase();if(!Ee.includes(h))continue;const v=Oe({tag:h,props:a.getAttributeNames().reduce((p,y)=>({...p,[y]:a.getAttribute(y)}),{})}),g=i.findIndex(p=>p&&(p.tag._d===v||a.isEqualNode(p.$el)));if(g!==-1){const p=i[g];p.$el=a,b(p),f(p),delete i[g]}}i.forEach(a=>{if(a.$el){switch(a.tag.tagPosition){case"bodyClose":n.body.appendChild(a.$el);break;case"bodyOpen":n.body.insertBefore(a.$el,n.body.firstChild);break;case"head":default:n.head.appendChild(a.$el);break}f(a)}})}});for(const o of c)await e.hooks.callHook("dom:renderTag",o);Object.values(s).forEach(o=>o())}let T=null;async function Me(e,r={}){function t(){return T=null,Se(e,r)}const n=r.delayFn||(s=>setTimeout(s,10));return T=T||new Promise(s=>n(()=>s(t())))}export{Re as V,je as c,Me as d,Se as r,De as u};
//# sourceMappingURL=@unhead-62e64392.js.map
